From f5babee9267f89fde07252e4f43619147b9e3a30 Mon Sep 17 00:00:00 2001
From: vitrescent <luongcaophong1312@gmail.com>
Date: Wed, 19 Nov 2025 21:35:35 +0700
Subject: [PATCH] left/right mouse, refactor old code

---
 src/lib/components/springs/softbody.svelte |  4 +-
 src/lib/components/vitrescent/mouselib.ts  | 44 ++++++++++++++++------
 2 files changed, 34 insertions(+), 14 deletions(-)

diff --git a/src/lib/components/springs/softbody.svelte b/src/lib/components/springs/softbody.svelte
index 0e01616..4b5a3d0 100644
--- a/src/lib/components/springs/softbody.svelte
+++ b/src/lib/components/springs/softbody.svelte
@@ -69,8 +69,8 @@
         });
 
         
-        if (mouse.isDown) {
-            if (mouse.changedState) {
+        if (mouse.leftDown) {
+            if (mouse.leftChanged) {
                 points.forEach(p => {
                     if (p.position.subtracted(mouse.position).length > p.radius + 20) { return }
                     heldPoints.push(p)
diff --git a/src/lib/components/vitrescent/mouselib.ts b/src/lib/components/vitrescent/mouselib.ts
index 9733a43..79ca83c 100644
--- a/src/lib/components/vitrescent/mouselib.ts
+++ b/src/lib/components/vitrescent/mouselib.ts
@@ -2,8 +2,11 @@ import { Vec2D } from "../springs/vec2d"
 
 export class Mouse {
     position = new Vec2D(0, 0)
-    isDown = false
-    changedState = false
+    leftDown = false
+    leftChanged = false
+
+    rightDown = false
+    rightChanged = false
 
     constructor(
         public canvas: HTMLCanvasElement
@@ -15,7 +18,12 @@ export class Mouse {
         this.canvas.addEventListener("pointerdown", this.onPointerDown)
         this.canvas.addEventListener("pointermove", this.onPointerMove)
         this.canvas.addEventListener("pointerup", this.onPointerUp)
-        this.canvas.addEventListener("pointercancel", this.onPointerUp)
+        this.canvas.addEventListener("contextmenu", this.onContextMenu)
+
+    }
+
+    onContextMenu(e: PointerEvent) {
+        e.preventDefault()
     }
 
     getRelativePos(event: PointerEvent) {
@@ -30,11 +38,17 @@ export class Mouse {
     }
 
     onPointerDown(e: PointerEvent) {
-        this.changedState = true
-        this.isDown = true
-        const pos = this.getRelativePos(e)
-        this.position.x = pos.x
-        this.position.y = pos.y
+        if (e.button === 0) {
+            this.leftChanged = true
+            this.leftDown = true
+        } else if (e.button === 2) {
+            this.rightChanged = true
+            this.rightDown = true
+        }
+
+        // const pos = this.getRelativePos(e)
+        // this.position.x = pos.x
+        // this.position.y = pos.y
     }
 
     onPointerMove(e: PointerEvent) {
@@ -43,12 +57,18 @@ export class Mouse {
         this.position.y = pos.y
     }
 
-    onPointerUp() {
-        this.changedState = true
-        this.isDown = false
+    onPointerUp(e: PointerEvent) {
+        if (e.button === 0) {
+            this.leftChanged = true
+            this.leftDown = false
+        } else if (e.button === 2) {
+            this.rightChanged = true
+            this.rightDown = false
+        }
+
     }
 
     onEndOfFrame() {
-        this.changedState = false
+        this.leftChanged = false
     }
 }
\ No newline at end of file
-- 
2.51.2

